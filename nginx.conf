worker_processes 1;

events {
    worker_connections 1024;
}

http {
    lua_shared_dict cache 20m;

    # Hide server version
    server_tokens off;
    more_clear_headers Server;

    # Enable gzip compression
    gzip on;
    gzip_http_version 1.1;
    gzip_comp_level 5;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_vary on;

    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    add_header X-XSS-Protection "1; mode=block";

    server {
        listen 80;

        location / {
            content_by_lua_file /usr/local/openresty/nginx/lua/app.lua;
        }

        # Cache static assets
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 30d;
            add_header Cache-Control "public";
        }
    }
}

